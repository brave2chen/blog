---
title: SpringBoot修改Tomcat参数relaxedPathChars支持请求特殊符号
date: 2020-04-09
sidebar: false
tags:
 - SpringBoot
 - Tomcat
categories:
 - Java
---
::: danger 问题
tomcat报Invalid character found in the request target. The valid characters are defined in RFC 7230 and RFC 3986错，
::: 
::: warning 原因
RFC 3986规范定义了Url中只允许包含英文字母（a-zA-Z）、数字（0-9）、-_.~4个特殊字符以及所有保留字符(RFC3986中指定了以下字符为保留字符：! * ’ ( ) ; : @ & = + $ , / ? # [ ])。而我们的系统在通过地址传参时，在url中传了一段json，传入的参数中有”{“不在RFC3986中的保留字段中，所以会报这个错。
:::

::: tip 方案
添加如下Tomcat配置类
:::
```java
@Configuration
public class TomcatConfig {
    @Bean
    public ConfigurableServletWebServerFactory webServerFactory() {
        TomcatServletWebServerFactory factory = new TomcatServletWebServerFactory();
        factory.addConnectorCustomizers(connector -> {
            connector.setProperty("relaxedQueryChars", "|{}[]"); // 允许的特殊字符
        });
        return factory;
    }
}
```

::: theorem 其他参数也是一样配置，如：
```connector.setProperty("relaxedPathChars", "\"<>[\\]^`{|}");```
:::